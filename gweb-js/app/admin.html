<!doctype html>
<html lang="">
<head>
<meta charset="utf-8">
<title>gweb-js</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="shortcut icon" href="/favicon.ico">

<!-- build:css(.) styles/vendor.css -->
<!-- bower:css -->
<link rel="stylesheet"
	href="/bower_components/bootstrap/dist/css/bootstrap.css" />
	
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	
<!-- endbower -->
<!-- endbuild -->

<link rel="canonical" href="http://sheet.topzone.biz">
<style>
table.fixed {
	table-layout: fixed;
}

table.fixed td {
	overflow: hidden;
}

table td {
	text-align: center;
}
</style>
<script>
	window.___gcfg = {
		parsetags : 'explicit'
	};
</script>

</head>
<body>
	<!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

	<div class="container">
		<div class="header">
			<h3 class="text-muted">
				English Sermon Service Admin Page
				of San Jose
			</h3>
		</div>

		<div class="side-body">

			<legend style="margin-top: 30px">
				<i class="fa fa-universal-access" aria-hidden="true"></i>
				<i data-placement="right"></i> Sign In
			</legend>

			<div class="row">
				<div class="col-md-12">
					<form id="form1" class="form-horizontal">
						<div class="form-group">
							<label class="control-label col-sm-2" for="A">User Id</label>
							<div class="col-sm-3">
								<div class="form-inline">
									<input type="text" id="A" name="A" value="doohee323@gmail.com"
										class="form-control">
								</div>
							</div>
							<label class="control-label col-sm-2" for="B">Date</label>
							<div class="col-sm-3">
								<div class="form-inline">
									<input type="text" id="B" name="B" value=""
										class="form-control" disabled>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12" style='text-align: right;'>
					<button type="button" class="btn btn-primary" id="sheet_1"
						onclick="execute('signin');">Sign In</button>
				</div>
			</div>

			<legend style="margin-top: 30px">
				<i class="fa fa-check-square-o" aria-hidden="true"></i>
				<i data-placement="right"></i> Update Youtub URL
			</legend>

			<div class="row">
				<div class="col-md-12">
					<form id="form1" class="form-horizontal">
						<div class="form-group">
							<label class="control-label col-sm-1" for="_version">Version</label>
							<div class="col-sm-1">
								<div class="form-inline">
									<input type="text" id="_version" name="_version" value="1"
										class="form-control"> <input type="hidden" id="_docid"
										name="_docid"
										value="11Zwm14ohuICi_7u8QCQVbRwUDKfcPewpTRfJHi6QyhE"
										class="form-control">
								</div>
							</div>
							<label class="control-label col-sm-2" for="A2">Date</label>
							<div class="col-sm-2">
								<div class="form-inline">
									<input type="text" id="A2" name="A2" value=""
										class="form-control">
								</div>
							</div>
							<label class="control-label col-sm-2" for="B2">Youtub URL</label>
							<div class="col-sm-4">
								<input type="text" id="B2" name="B2" value=""
									class="form-control">
							</div>
						</div>
					</form>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12" style='text-align: right;'>
					<button type="button" class="btn btn-primary" id="sheet_1"
						onclick="execute('update');">Update</button>
				</div>
			</div>


			<legend style="margin-top: 30px">
				<i class="fa fa-bars" aria-hidden="true"></i>
				<i data-placement="right"></i> Last Sermons
			</legend>

			<div class="row">
				<div class="col-md-12">
					<div id="table_wrapper">
						<table id="runningLogs"
							class="table table-bordered table-hover fixed">
							<thead>
								<tr>
									<th class='text-center'>Date</th>
									<th class='text-center'>Link</th>
									<th class='text-center'>Delete</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12" style='text-align: right;'>
					<button type="button" class="btn btn-primary" id="sheet_1"
						onclick="execute('runningLogs');">Query</button>
				</div>
			</div>

			<legend style="margin-top: 30px">
				<i class="fa fa-check-square-o" aria-hidden="true"></i>
				<i data-placement="right"></i> Statistics
			</legend>

			<div class="row">
				<div class="col-md-12">
					<form id="form2" class="form-horizontal">
						<div class="form-group">
							<label class="control-label col-sm-2" for="col_1">Service
								Period</label>
							<div class="col-sm-3">
								<div class="form-inline">
									<input type="text" id="col_1" name="col_1" value=""
										class="form-control" disabled style='width: 100px'> ~
									<input type="text" id="col_2" name="col_2" value=""
										class="form-control" disabled style='width: 100px'>
								</div>
							</div>
							<label class="control-label col-sm-2" for="col_3">Total
								Log Count</label>
							<div class="col-sm-3">
								<div class="form-inline">
									<input type="text" id="col_3" name="col_3" value=""
										class="form-control" disabled>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-2" for="col_4">Total
								Viewer Count</label>
							<div class="col-sm-3">
								<div class="form-inline">
									<input type="text" id="col_4" name="col_4" value=""
										class="form-control" disabled>
								</div>
							</div>
							<label class="control-label col-sm-2" for="col_5">Total
								View Sum</label>
							<div class="col-sm-3">
								<div class="form-inline">
									<input type="text" id="col_5" name="col_5" value=""
										class="form-control" disabled>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12" style='text-align: right;'>
					<button type="button" class="btn btn-primary" id="sheet_1"
						onclick="execute('stats');">Query</button>
				</div>
			</div>

			<legend style="margin-top: 30px">
				<i class="fa fa-bars" aria-hidden="true"></i>
				<i data-placement="right"></i> Sign In Logs
			</legend>

			<div class="row">
				<div class="col-md-12">
					<div id="table_wrapper">
						<table id="accessLogs"
							class="table table-bordered table-hover fixed">
							<thead>
								<tr>
									<th class='text-center'>sn</th>
									<th class='text-center'>id</th>
									<th class='text-center'>date</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<table id='accessLog_template' style='display: none'>
							<tr>
								<td class='text-center'>{sn}</td>
								<td class='text-center'>{id}</td>
								<td class='text-left'>{date}</td>
							</tr>
						</table>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12" style='text-align: right;'>
					<button type="button" class="btn btn-primary" id="sheet_1"
						onclick="execute('accessLogs');">Query</button>
				</div>
			</div>

			<legend style="margin-top: 30px">
				<i class="fa fa-info-circle" aria-hidden="true"></i>
				<i data-placement="right"></i> Management pages
			</legend>

			<div class="row">
				<div class="col-md-12">
					<form id="form1" class="form-horizontal">
						<div class="form-group">
							<div class="col-sm-2" style='margin-top: 8px;'></div>
							<div class="col-sm-3" style='margin-top: 8px;'>
								<a href='http://gwebj.topzone.biz/app/public.html'
									target='_blank'>Public page</a>
							</div>
							<div class="col-sm-3" style='margin-top: 8px;'>
								<a href='https://docs.google.com/spreadsheets/d/1XDL65l6EcERiwNvAUKTBOpWzoxhMZQP04VaSS80FbmM/edit#gid=0'
									target='_blank'>Sheet file</a>
							</div>
							<div class="col-sm-3" style='margin-top: 8px;'>
								<a href='https://www.youtube.com/my_live_events?filter=active'
									target='_blank'>Youtub Console</a>
							</div>
							<div class="col-sm-1" style='margin-top: 8px;'></div>
						</div>
					</form>
				</div>
			</div>

			<legend style="margin-top: 30px">
				<i class="fa fa-bars" aria-hidden="true"></i>
				<i data-placement="right"></i> Debug
			</legend>

			<div class="row">
				<div class="col-md-12">
					<div id="table_wrapper">
						<table id="debuglist"
							class="table table-bordered table-hover fixed">
							<thead>
								<tr>
									<th class='text-center'>version</th>
									<th class='text-center'>elapse</th>
									<th class='text-center'>input</th>
									<th class='text-center'>output</th>
									<th class='text-center'>meta</th>
									<th class='text-center'>log</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<table id='template' style='display: none'>
							<tr>
								<td class='text-center'>{version}</td>
								<td class='text-center'>{elapse}</td>
								<td class='text-left'>{input}</td>
								<td class='text-left'>{output}</td>
								<td class='text-left'>{meta}</td>
								<td class='text-left'>{log}</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
		</div>

		<div class="footer" style='margin-top: 50px;'>
		</div>
	</div>

	<!-- build:js(.) scripts/vendor.js -->
	<!-- bower:js -->
	<script src="/bower_components/jquery/dist/jquery.js"></script>
	<script src="/bower_components/moment/moment.js"></script>
	<!-- endbower -->
	<!-- endbuild -->

	<!-- build:js(.) scripts/plugins.js -->
	<script src="/bower_components/bootstrap/js/affix.js"></script>
	<script src="/bower_components/bootstrap/js/alert.js"></script>
	<script src="/bower_components/bootstrap/js/dropdown.js"></script>
	<script src="/bower_components/bootstrap/js/tooltip.js"></script>
	<script src="/bower_components/bootstrap/js/modal.js"></script>
	<script src="/bower_components/bootstrap/js/transition.js"></script>
	<script src="/bower_components/bootstrap/js/button.js"></script>
	<script src="/bower_components/bootstrap/js/popover.js"></script>
	<script src="/bower_components/bootstrap/js/carousel.js"></script>
	<script src="/bower_components/bootstrap/js/scrollspy.js"></script>
	<script src="/bower_components/bootstrap/js/collapse.js"></script>
	<script src="/bower_components/bootstrap/js/tab.js"></script>
	<!-- endbuild -->

	<!-- build:js scripts/sheet -->
	<script src="scripts/gweb_c.js"></script>
	<!-- endbuild -->

	<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
	<script>
		(function(b, o, i, l, e, r) {
			b.GoogleAnalyticsObject = l;
			b[l] || (b[l] = function() {
				(b[l].q = b[l].q || []).push(arguments)
			});
			b[l].l = +new Date;
			e = o.createElement(i);
			r = o.getElementsByTagName(i)[0];
			e.src = 'https://www.google-analytics.com/analytics.js';
			r.parentNode.insertBefore(e, r)
		}(window, document, 'script', 'ga'));
		ga('create', 'UA-XXXXX-X');
		ga('send', 'pageview');
	</script>

	<script>
		var tbObj;
		var accessObj;
		var runningObj;
		$(document)
				.ready(
						function() {

							$('#B').val(moment().format('L'));
							$('#A2').val(moment().format('L'));

							accessObj = $('#accessLogs').DataTable({
								"paging" : false,
								"lengthChange" : false,
								"searching" : false,
								"ordering" : true,
								"info" : true,
								"autoWidth" : true
							});

							tbObj = $('#debuglist').DataTable({
								"paging" : false,
								"lengthChange" : false,
								"searching" : false,
								"ordering" : true,
								"info" : true,
								"autoWidth" : true
							});

							runningObj = $('#runningLogs').DataTable({
								"columnDefs" : [ {
									"className" : "dt-center"
								} ],
								"paging" : true,
								"pageLength" : 5,
								"lengthChange" : false,
								"searching" : false,
								"ordering" : true,
								"info" : true,
								"autoWidth" : true
							});

							execute('runningLogs');

							$('#runningLogs tbody')
									.on(
											'click',
											'.delete-button',
											function() {
												var row = $(this).parent()
														.parent();
												var col1 = $(row.find('td')[0])
														.text();
												var col2 = $(row.find('td')[1])
														.text();

												for (var i = 0; i < runningObj
														.rows().data().length; i++) {
													var str = runningObj.rows()
															.data()[i];
													if (str[0].indexOf(col1) > -1
															&& str[1]
																	.indexOf(col2) > -1) {
														var option = {};
														us.config['deleteYoutub'].input.row = i + 1;
														us
																.execute(
																		'deleteYoutub',
																		option,
																		function(
																				rslt) {
																			$(
																					row)
																					.remove();
																		})
													}
												}
											});

						});

		var gconfig = {
			'gauth' : {
				'url' : 'https://script.google.com/macros/s/AKfycbz-09xmCUhDXdYS62TzZYhEH7j-Vo0hFjy7a2FrCztl05GJ-aA/exec',
				'client_id' : '104253425235-kfab48mmaa2njrk0eqkr5450tpf99hms.apps.googleusercontent.com'
			},
			'update' : {
				'params' : [ {
					"_sheet" : "config",
					"_event" : "update",
					'A2' : '10/30/2016',
					'B2' : 'http://youtu.be/L9LP9mfvtDA'
				}, {
					"_sheet" : "running_logs",
					"_event" : "appendRow",
					'A' : '10/30/2016',
					'B' : 'http://youtu.be/L9LP9mfvtDA'
				} ]
			},
			'signin' : {
				'input' : {
					"_sheet" : "access_logs",
					"_event" : "appendRow",
					'A' : 'doohee323@gmail.com',
					'B' : '10/30/2016'
				}
			},
			'runningLogs' : {
				'input' : {
					"_sheet" : "running_logs",
					"_event" : "getList",
					'output' : "['A','B']"
				}
			},
			'deleteYoutub' : {
				'input' : {
					"_sheet" : "running_logs",
					"_event" : "deleteRow",
					'row' : 1,
					'count' : 1
				}
			},
			'stats' : {
				'input' : {
					"_sheet" : "stats",
					"_event" : "getValue",
					'col_1' : 'E1',
					'col_2' : 'F1',
					'col_3' : 'E2',
					'col_4' : 'E3',
					'col_5' : 'E4'
				}
			},
			'accessLogs' : {
				'input' : {
					"_sheet" : "access_logs",
					"_event" : "getList",
					'output' : "['A','B']"
				}
			}
		}

		var us = new GWeb(gconfig);

		function execute(sheet) {
			us.setInputParams(sheet, 0);
			us.setInputParams(sheet, 1, '2');

			var option = {
				version : $('#_version').val(),
				cache : false
			}

			if (sheet === 'signin') {
				option.nosession = true;
			}
			us
					.execute(
							sheet,
							option,
							function(rslt) {
								if (rslt.output) {
									if (rslt.output.rows) {
										if (rslt.input._sheet === 'access_logs') {
											if ($.fn.DataTable
													.isDataTable('#accessLogs')) {
												$('#accessLogs').DataTable()
														.destroy();
											}
											$('#accessLogs tbody').empty();

											for (var i = 1; i < rslt.output.rows.length; i++) {
												var tmp = $(
														'#accessLog_template')
														.find('tr').html();
												tmp = tmp.replace('{sn}', i);
												tmp = tmp.replace('{id}',
														rslt.output.rows[i]['A'
																+ (i + 1)]);
												tmp = tmp.replace('{date}',
														rslt.output.rows[i]['B'
																+ (i + 1)]);
												$("#accessLogs")
														.find('tbody')
														.append(
																'<tr>'
																		+ tmp
																		+ '</tr>');
											}
										} else if (rslt.input._sheet === "running_logs") {
											if ($.fn.DataTable
													.isDataTable('#runningLogs')) {
												$('#runningLogs').DataTable()
														.destroy();
											}
											$('#runningLogs tbody').empty();
											runningObj.clear();

											for (var i = 0; i < rslt.output.rows.length; i++) {
												var date = rslt.output.rows[i]['A'
														+ (i + 1)];
												date = moment(date).format(
														'LLL');
												var link = "<a href='{link}' target='_blank'>{link}</a>";
												var lk = rslt.output.rows[i]['B'
														+ (i + 1)];
												link = link.replace('{link}',
														lk).replace('{link}',
														lk);
												var del = "<a href='javascript: void(0);' class='btn btn-default btn-sm delete-button'> <i class='fa fa-trash' style='color: #b42121'></i> <i class='fa fa-angle-right'>Delete</i>";
												del = del.replace('{sn}', i);
												runningObj.row.add(
														[ date, link, del ])
														.draw(false);
											}
										}

									} else {
										for ( var key in rslt.output) {
											$('#' + key).val(rslt.output[key]);
										}
									}
								}

								if (rslt.meta) {
									if ($.fn.DataTable
											.isDataTable('#debuglist')) {
										$('#debuglist').DataTable().destroy();
									}
									$('#debuglist tbody').empty();

									var tmp = $('#template').find('tr').html();
									tmp = tmp.replace('{version}',
											rslt.meta.version);
									tmp = tmp.replace('{elapse}',
											rslt.meta.total);
									tmp = tmp.replace('{input}', JSON
											.stringify(rslt.input));
									tmp = tmp.replace('{output}', JSON
											.stringify(rslt.output));
									tmp = tmp.replace('{meta}', JSON
											.stringify(rslt.meta));
									tmp = tmp
											.replace('{log}', rslt.meta.logstr);

									$("#debuglist").find('tbody').append(
											'<tr>' + tmp + '</tr>');
								}
							})
		}
	</script>

	<script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
	<script src="//cdn.datatables.net/1.10.12/js/dataTables.bootstrap.js"></script>

</body>
</html>