<!doctype html>
<html lang="">
<head>
<meta charset="utf-8">
<title>gweb-js</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="shortcut icon" href="/favicon.ico">

<!-- build:css(.) styles/vendor.css -->
<!-- bower:css -->
<link rel="stylesheet"
	href="/bower_components/bootstrap/dist/css/bootstrap.css" />

<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- endbower -->
<!-- endbuild -->

<link rel="canonical" href="http://sheet.topzone.biz">
<style>
table.fixed {
	table-layout: fixed;
}

table.fixed td {
	overflow: hidden;
}

table td {
	text-align: center;
}

.header_a {
	background-color: #1A5276;
	color: white;
	cursor: pointer;
}

@media screen and (min-width: 768px) {
    .modal-dialog {
      width: 800px; /* New width for default modal */
    }
    .modal-sm {
      width: 450px; /* New width for small modal */
    }
}
@media screen and (min-width: 992px) {
    .modal-lg {
      width: 1050px; /* New width for large modal */
    }
}

</style>
<script>
	window.___gcfg = {
		parsetags : 'explicit'
	};
</script>

    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Oxygen:400,700">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
		<script src="/bower_components/jquery/dist/jquery.js"></script>
		<script src="scripts/gweb_c.js"></script>

</head>
<body>
	<!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

	<div class="container">
		<div class="header">
			<h3 class="text-muted">
				Largest IT companies by revenue
			</h3>
		</div>
			
		<div class="row">
			<div class="col-xs-12">
				<div class="box">
					<div class="box-body">
			      <table id="table_companies" class="table table-bordered table-hover">
			        <thead>
			          <tr>
			            <th class='text-center' >Id</th>
			            <th>Rank</th>
			            <th>Company name</th>
			            <th>Industries</th>
			            <th>Revenue</th>
			            <th>Year</th>
			            <th>Employees</th>
			            <th>Market cap</th>
			            <th>Headquarters</th>
			            <th>Functions</th>
			          </tr>
			         </thead>
			         <tbody>
			         </tbody>
				      </table>
				      <button type="button" id="add" class="btn btn-primary">Add</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" id="modalId">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header modal-header-primary">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
						<h4 class="modal-title">Company</h4>
					</div>
					<div class="modal-body">
						<form class="form add form-horizontal" id="form_company" data-id="" novalidate>
		        	<div class="form-group">
								<label class="control-label col-sm-3" for="rank">Rank: <span class="required">*</span></label>
								<div class="col-sm-3">
									<div class="form-inline">
										<input type="hidden" class="form-control" name="id" id="id" value="">
										<input type="number" step="1" min="0" class="form-control" name="rank" id="rank" value="" required>
		        			</div>
		        		</div>
								<label class="control-label col-sm-3" for="company_name">Company name: <span class="required">*</span></label>
								<div class="col-sm-3">
									<div class="form-inline">
										<input type="form-control" class="form-control" name="company_name" id="company_name" value="" required>
		        			</div>
		        		</div>
		          </div>
		          
		        	<div class="form-group">
								<label class="control-label col-sm-3" for="industries">Industries: <span class="required">*</span></label>
								<div class="col-sm-3">
									<div class="form-inline">
										<input type="form-control" class="form-control" name="industries" id="industries" value="" required>
		        			</div>
		        		</div>
								<label class="control-label col-sm-3" for="revenue">Revenue: <span class="required">*</span></label>
								<div class="col-sm-3">
									<div class="form-inline">
										<input type="number" step="1" min="0" class="form-control" name="revenue" id="revenue" value="" required>
		        			</div>
		        		</div>
		          </div>
		          
		        	<div class="form-group">
								<label class="control-label col-sm-3" for="fiscal_year">Fiscal year: <span class="required">*</span></label>
								<div class="col-sm-3">
									<div class="form-inline">
										<input type="number" min="0" class="form-control" name="fiscal_year" id="fiscal_year" value="" required>
		        			</div>
		        		</div>
								<label class="control-label col-sm-3" for="employees">Employees: <span class="required">*</span></label>
								<div class="col-sm-3">
									<div class="form-inline">
										<input type="number" min="0" class="form-control" name="employees" id="employees" value="" required>
		        			</div>
		        		</div>
		          </div>          
		          
		        	<div class="form-group">
								<label class="control-label col-sm-3" for="market_cap">Market cap: <span class="required">*</span></label>
								<div class="col-sm-3">
									<div class="form-inline">
										<input type="number" step="1" min="0" class="form-control" name="market_cap" id="market_cap" value="" required>
		        			</div>
		        		</div>
								<label class="control-label col-sm-3" for="headquarters">Headquarters: <span class="required">*</span></label>
								<div class="col-sm-3">
									<div class="form-inline">
										<input type="form-control" class="form-control" name="headquarters" id="headquarters" value="" required>
		        			</div>
		        		</div>
		          </div>  
		        </form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal" id="insertData">Add</button>
						<button type="button" class="btn btn-primary" data-dismiss="modal" id="updateData">Update</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->

		<!-- build:js(.) scripts/vendor.js -->
		<!-- bower:js -->
		<script src="/bower_components/jquery/dist/jquery.js"></script>
		<script src="/bower_components/moment/moment.js"></script>
		<!-- endbower -->
		<!-- endbuild -->
		
		<!-- build:js(.) scripts/plugins.js -->
		<script src="/bower_components/bootstrap/js/affix.js"></script>
		<script src="/bower_components/bootstrap/js/alert.js"></script>
		<script src="/bower_components/bootstrap/js/dropdown.js"></script>
		<script src="/bower_components/bootstrap/js/tooltip.js"></script>
		<script src="/bower_components/bootstrap/js/modal.js"></script>
		<script src="/bower_components/bootstrap/js/transition.js"></script>
		<script src="/bower_components/bootstrap/js/button.js"></script>
		<script src="/bower_components/bootstrap/js/popover.js"></script>
		<script src="/bower_components/bootstrap/js/carousel.js"></script>
		<script src="/bower_components/bootstrap/js/scrollspy.js"></script>
		<script src="/bower_components/bootstrap/js/collapse.js"></script>
		<script src="/bower_components/bootstrap/js/tab.js"></script>
		<!-- endbuild -->

  </body>

<script>
var table_companies;
$(document).ready(function(){
  
  // On page load: datatable
  table_companies = $('#table_companies').DataTable({
    "aoColumnDefs": [
      { "bSortable": false, "aTargets": [-1] }
    ],
    "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
    "oLanguage": {
      "oPaginate": {
        "sFirst":       " ",
        "sPrevious":    " ",
        "sNext":        " ",
        "sLast":        " ",
      },
      "sLengthMenu":    "Records per page: _MENU_",
      "sInfo":          "Total of _TOTAL_ records (showing _START_ to _END_)",
      "sInfoFiltered":  "(filtered from _MAX_ total records)"
    }
  });
  
  jQuery.validator.setDefaults({
    success: 'valid',
    rules: {
      fiscal_year: {
        required: true,
        min:      2000,
        max:      2025
      }
    },
    errorPlacement: function(error, element){
      error.insertBefore(element);
    },
    highlight: function(element){
      $(element).parent('.field_container').removeClass('valid').addClass('error');
    },
    unhighlight: function(element){
      $(element).parent('.field_container').addClass('valid').removeClass('error');
    }
  });
  var form_company = $('#form_company');
  form_company.validate();

	function execute(sheet, cb) {
		var option = {
			cache : false,
			sessionCache : true
		}
		us.cb = cb;
		us.execute(sheet, option, function(rslt) {
				if (us.cb) {
					us.cb.call(null, rslt);
				}
			})		
	}

	function queryList() {
	  execute('rankList', function(rslt) {
		  if ($.fn.DataTable
					.isDataTable('#table_companies')) {
				$('#table_companies').DataTable()
						.destroy();
			}
			$('#table_companies tbody').empty();
			table_companies.clear();
			for (var i = 1; i < rslt.output.rows.length; i++) {
				var row = rslt.output.rows[i];
				// row[0]
    		var html = "<a href='javascript: void(0);' class='btn btn-default btn-sm edit-button'> <i class='fa fa-pencil-square-o'></i> <i class='fa fa-angle-right'>Edit</i>";
    		html += "<a href='javascript: void(0);' class='btn btn-default btn-sm delete-button'> <i class='fa fa-trash' style='color: #b42121'></i> <i class='fa fa-angle-right'>Delete</i>";
        row.push(html);
				if (row[0]) {
				  table_companies.row
							.add(row)
							.draw(false);
				}
			}
		})
	}
	
	queryList();
	
  $("#add").click(function() {
    $('#insertData').show();
    $('#updateData').hide();
    $('.modal-footer').css('margin-top','0px');
    
    $('#form_company #rank').val('');
    $('#form_company #company_name').val('');
    $('#form_company #industries').val('');
    $('#form_company #revenue').val('');
    $('#form_company #fiscal_year').val('');
    $('#form_company #employees').val('');
    $('#form_company #market_cap').val('');
    $('#form_company #headquarters').val('');
    $('#modalId').modal();
  });

  $("#insertData").click(function() {
    if (form_company.valid() == true){
			us.config['appendRank'].input.A = us.getNextSn(table_companies.data(), 0);
			us.config['appendRank'].input.B = $('#rank').val();
			us.config['appendRank'].input.C = $('#company_name').val();
			us.config['appendRank'].input.D = $('#industries').val();
			us.config['appendRank'].input.E = $('#revenue').val();
			us.config['appendRank'].input.F = $('#fiscal_year').val();
			us.config['appendRank'].input.G = $('#employees').val();
			us.config['appendRank'].input.H = $('#market_cap').val();
			us.config['appendRank'].input.I = $('#headquarters').val();
    	execute('appendRank', function(rslt) {
        if (rslt.output.msg == 'success'){
          queryList();
          return;
          var input = [];
          Object.keys(us.config['appendRank'].input).forEach(function (key) {
      		  if(key.indexOf('_') != 0) {
      		    input.push(us.config['appendRank'].input[key]);
      		  }
      		})
      		var id = us.config['appendRank'].input.A;
      		var company_name = $('#company_name').val();
      		
      		var html = "<a href='javascript: void(0);' class='btn btn-default btn-sm edit-button'> <i class='fa fa-pencil-square-o'></i> <i class='fa fa-angle-right'>Edit</i>";
      		html += "<a href='javascript: void(0);' class='btn btn-default btn-sm delete-button'> <i class='fa fa-trash' style='color: #b42121'></i> <i class='fa fa-angle-right'>Delete</i>";
	        input.push(html);
				  table_companies.row
					.add(input)
					.draw(false);
          var company_name = $('#company_name').val();
          show_message("Company '" + company_name + "' added successfully.", 'success');
        } else {
          show_message('Add request failed: ' + textStatus, 'error');
        }
  		})      
    }
  });

	$('#table_companies tbody').on('click', '.edit-button', function() {
    $('#insertData').hide();
    $('#updateData').show();
    $('.modal-footer').css('margin-top','150px');
    
		var row = $(this).parent().parent();
		var id = $(row.find('td')[0]).text();
    var data = table_companies.data();
    var rowIdx = us.getRowIndex(table_companies.data(), 0, parseInt(id));
    $('.lightbox_content h2').text('Edit company');
    $('#form_company button').text('Edit company');
    $('#form_company').attr('class', 'form edit');
    $('#form_company').attr('data-id', id);
    $('#form_company .field_container label.error').hide();
    $('#form_company .field_container').removeClass('valid').removeClass('error');
    $('#form_company #id').val(data[rowIdx][0]);
    $('#form_company #rank').val(data[rowIdx][1]);
    $('#form_company #company_name').val(data[rowIdx][2]);
    $('#form_company #industries').val(data[rowIdx][3]);
    $('#form_company #revenue').val(data[rowIdx][4]);
    $('#form_company #fiscal_year').val(data[rowIdx][5]);
    $('#form_company #employees').val(data[rowIdx][6]);
    $('#form_company #market_cap').val(data[rowIdx][7]);
    $('#form_company #headquarters').val(data[rowIdx][8]);
    $('#modalId').modal();
	});  
  
  $("#updateData").click(function() {
    if (form_company.valid() == true){
      var id = parseInt($('#form_company #id').val());
      var rowIdx = us.getRowIndex(table_companies.data(), 0, id) + 2;
			us.config['updateRank'].params[0]['B' + rowIdx] = $('#rank').val();
			us.config['updateRank'].params[0]['C' + rowIdx] = $('#company_name').val();
			us.config['updateRank'].params[0]['D' + rowIdx] = $('#industries').val();
			us.config['updateRank'].params[0]['E' + rowIdx] = $('#revenue').val();
			us.config['updateRank'].params[0]['F' + rowIdx] = $('#fiscal_year').val();
			us.config['updateRank'].params[0]['G' + rowIdx] = $('#employees').val();
			us.config['updateRank'].params[0]['H' + rowIdx] = $('#market_cap').val();
			us.config['updateRank'].params[0]['I' + rowIdx] = $('#headquarters').val();
			
			var option = {
			    sessionCache :  true
			}
			us.execute('updateRank', option, function(rslt) {
			  queryList();
			})			
    }
  });
  
	$('#table_companies tbody').on('click', '.delete-button', function() {
		var row = $(this).parent().parent();
		var company_name = $(row.find('td')[3]).text();
    if (confirm("Are you sure you want to delete '" + company_name + "'?")){
  		var id = $(row.find('td')[0]).text();
      var data = table_companies.data();
      var rowIdx = us.getRowIndex(table_companies.data(), 0, parseInt(id));
			us.config['deleteRank'].input.row = rowIdx + 2;
    	execute('deleteRank', function(rslt) {
        if (rslt.output.msg == 'success'){
          $(row).remove();
          show_message("Company '" + company_name + "' deleted successfully.", 'success');
        } else {
          show_message('Delete request failed', 'error');
        }
  		})      
    }
  });
});

	var gconfig = {
		'gauth' : {
			'url' : 'https://script.google.com/macros/s/AKfycbyh2sdXwa8URnhBt3fJfyKXvfflxVWUKE4ir9lL8Ujlva8SnWU/exec',
			'client_id' : '414052581199-rfhl6sup7r1etrunrfmo2ckf12uv4obo.apps.googleusercontent.com'
		},
		'rankList' : {
			'input' : {
				"_sheet" : "rank",
				"_event" : "getList",
				'input' : "[1,1,'_end',9]"
			}
		},
		'deleteRank' : {
			'input' : {
				"_sheet" : "rank",
				"_event" : "deleteRow",
				'row' : 1,
				'count' : 1
			}
		},
		'appendRank' : {
			'input' : {
				"_sheet" : "rank",
				"_event" : "appendRow"
			}
		},
		'updateRank' : {
			'params' : [ {
				"_sheet" : "rank",
				"_event" : "update"
			} ]
		}
	}

	var us = new GWeb(gconfig);
	
</script>  
  
	<script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
	<script src="//cdn.datatables.net/1.10.12/js/dataTables.bootstrap.js"></script>
	<script charset="utf-8" src="//cdn.jsdelivr.net/jquery.validation/1.13.1/jquery.validate.js"></script>

</html>