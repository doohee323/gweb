<!doctype html>
<html lang="">
<head>
<meta charset="utf-8">
<title>gweb-sb</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="shortcut icon" href="/favicon.ico">

<!-- build:css(.) styles/vendor.css -->
<!-- bower:css -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
<!-- endbower -->
<!-- endbuild -->

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
table.fixed {
	table-layout: fixed;
}

table.fixed td {
	overflow: hidden;
}
</style>
<script>
	window.___gcfg = {
		parsetags : 'explicit'
	};
</script>

</head>
<body>
	<!--[if lt IE 10]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

	<div class="container">
		<div class="header">
			<h3 class="text-muted">
				English Sermon Service<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - Korean Baptist Church of San Jose
			</h3>
		</div>

		<div class="side-body">

			<legend style="margin-top: 30px">
				<i class="fa fa-info-circle" aria-hidden="true"></i>
				<i data-placement="right"></i> Live URL
			</legend>

			<div class="row">
				<div class="col-md-12">
					<form id="form1" class="form-horizontal">
						<div class="form-group">
							<label class="control-label col-sm-2" for="col_4">Link</label>
							<div class="col-sm-10">
								<div class="form-inline">
									<input type="text" id="col_4" name="col_4" value=""
										style='width: 90%' class="form-control">
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<form id="form1" class="form-horizontal">
						<div class="form-group">
							<label class="control-label col-sm-2" for="debug"></label>
							<div class="col-sm-4">
								<div class="form-inline">
									<button type="button" class="btn btn-primary" id='reload'>Reload</button>
									<button type="button" class="btn btn-primary" id='open'>Open</button>
									<div id="debug"></div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>

			<legend style="margin-top: 30px">
				<i class="fa fa-bars" aria-hidden="true"></i>
				<i data-placement="right"></i> Last Sermons
			</legend>

			<div class="row">
				<div class="col-md-12">
					<div id="table_wrapper">
						<table id="runningLogs"
							class="table table-bordered table-hover fixed">
							<thead>
								<tr>
									<th class='text-center'>Date</th>
									<th class='text-center'>Link</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<table id='runningLog_template' style='display: none'>
							<tr>
								<td class='text-center'>{date}</td>
								<td class='text-center'><a href='{link}' target='_blank'>{link}</a></td>
							</tr>
						</table>
					</div>
				</div>
			</div>

			<div class="footer" style='margin-top: 50px;'>
				<div class="logo">
					<img src="http://www.kbcsj.com/img/foot_logo.jpg" border="0">
				</div>
				<div class="copyright">
					1056 Pinewood Dr.San Jose, CA 95129 / TEL : 408-257-5444 / FAX :
					408-257-4967 / E-mail : kbcsj1971@gmail.com<br> CopyrightÂ©
					2015 by Korean Baptist Church of San Jose. All rights reserved. <a
						href="http://www.hosannaweb.net" target="_blank"> <img
						src="http://www.kbcsj.com/img/foot_hosanna.jpg" border="0"
						align="absmiddle"></a>
				</div>
			</div>
		</div>

		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.2/moment.min.js"></script>

		<script src="scripts/gweb_c.js"></script>
		<?!= include('myscript.js'); ?>

		<script>
			var runningObj;
			var us;
			$(document).ready(function() {
				runningObj = $('#runningLogs').DataTable({
					"paging" : true,
					"pageLength" : 5,
					"lengthChange" : false,
					"searching" : false,
					"ordering" : true,
					"info" : true,
					"autoWidth" : true
				});

				$("#reload").click(function(e) {
					getLink();
				});
				$("#open").click(function(e) {
					window.open($("#col_4").val());
				});

				function getLink() {
					$('#col_4').val('');
					var url = '/rest/getLink';
					$.ajax({
						method : 'GET',
						url : url,
						dataType : 'json'
					}).done(function(data) {
						if(data.col_4) {
							console.timeEnd("ajax response time");
							// console.log(JSON.stringify(data));
							$('#col_4').val(data.col_4);
							runningLogs();
						} else {
							$('#msg').text(data.msg);
						}
					}).fail(function(msg) {
						console.log(JSON.stringify(msg));
						$('#msg').text(JSON.stringify(msg));
					})
				}
				
				function runningLogs() {
					debugger;
					var url = '/rest/runningLogs';
					$.ajax({
						method : 'GET',
						url : url,
						dataType : 'json'
					}).done(function(rslt) {
                        if (rslt) {
                            if (rslt.rows) {
                              if ($.fn.DataTable.isDataTable('#runningLogs')) {
                                $('#runningLogs').DataTable().destroy();
                              }
                              $('#runningLogs tbody').empty();

                              for (var i = 1; i < rslt.rows.length; i++) {
                                var tmp = $('#runningLog_template').find('tr')
                                    .html();
                                var date = rslt.rows[i]['A' + (i + 1)];
                                date = moment(date).format('LLL');
                                tmp = tmp.replace('{date}', date);
                                tmp = tmp.replace(/{link}/g,
                                    rslt.rows[i]['B' + (i + 1)]);
                                $("#runningLogs").find('tbody').append(
                                    '<tr>' + tmp + '</tr>');
                              }
                            } else {
                              us.getResults(rslt);
                            }
                          }					}).fail(function(msg) {
						console.log(JSON.stringify(msg));
						$('#msg').text(JSON.stringify(msg));
					})
				}	
				
				getLink();
				
			});
		</script>

		<script
			src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
		<script
			src="https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.js"></script>
</body>
</html>
